# ETL-процесс для аналитической системы чатов

## Описание

ETL-процесс предназначен для извлечения данных из оперативной базы данных чатов (OLTP) и их загрузки в аналитическую базу данных (OLAP) для последующего анализа и создания отчетов.

## Структура проекта

```
ETL/
  ├── config/              - Конфигурация ETL-процесса
  ├── extractors/          - Компоненты для извлечения данных из OLTP
  ├── transform/           - Компоненты для трансформации данных
  ├── load/                - Компоненты для загрузки данных в OLAP
  ├── models/              - Модели данных
  ├── utils/               - Вспомогательные утилиты
  ├── etl_runner.go        - Основной файл для запуска ETL
  └── run_etl.sh           - Скрипт для удобного запуска ETL-процесса
```

## Компоненты ETL

### Extract (Извлечение)

Компоненты извлечения данных находятся в директории `extractors/`. Они отвечают за:
- Извлечение новых или измененных данных из OLTP базы
- Инкрементальную загрузку (обработку только новых данных)
- Получение метаданных о последних запусках

### Transform (Трансформация)

Компоненты трансформации данных находятся в директории `transform/`. Они отвечают за:
- Преобразование данных в формат, подходящий для OLAP
- Формирование измерений (время, пользователи)
- Формирование фактов (сообщения, чаты, активность)
- Вычисление агрегатов и метрик

### Load (Загрузка)

Компоненты загрузки данных находятся в директории `load/`. Они отвечают за:
- Загрузку трансформированных данных в OLAP базу
- Обновление существующих записей
- Журналирование процесса загрузки

## Запуск ETL-процесса

### Требования

- Go 1.19 или выше
- MySQL 5.7 или выше
- Доступ к OLTP и OLAP базам данных

### Настройка

Настройки ETL-процесса находятся в файле `config/config.go`. Основные параметры:
- Параметры подключения к OLTP и OLAP базам данных
- Интервал запуска ETL-процесса
- Размер пакета обрабатываемых данных
- Пороговые значения для метрик активности

### Способы запуска

#### Однократный запуск

```bash
./run_etl.sh once
```

#### Запуск в режиме планировщика

```bash
./run_etl.sh
```

В режиме планировщика ETL-процесс будет выполняться с интервалом, указанным в конфигурации (по умолчанию 1 час).

### Логирование

Логи ETL-процесса сохраняются в файл `etl_log_YYYY-MM-DD.log` в директории ETL. Они содержат:
- Информацию о времени запуска и завершения
- Количество обработанных записей
- Ошибки и предупреждения
- Метрики производительности

## Расширение функциональности

Для добавления новых типов данных или метрик необходимо:

1. Определить новые модели данных в `models/`
2. Добавить извлечение новых данных в соответствующий экстрактор
3. Добавить трансформацию данных в соответствующий трансформатор
4. Добавить загрузку новых данных в соответствующий загрузчик

## Мониторинг и аудит

История запусков ETL сохраняется в таблице `etl_run_log` в OLAP базе данных. 
Эту информацию можно использовать для:
- Мониторинга регулярности выполнения ETL
- Анализа объема обрабатываемых данных
- Диагностики ошибок
- Оптимизации процесса ETL

## Известные проблемы и ограничения

1. В текущей реализации нет возможности отката изменений в случае ошибки (отсутствие транзакций между OLTP и OLAP).
2. Не реализовано параллельное выполнение компонентов ETL для ускорения процесса.

## Контактная информация

При обнаружении ошибок или для предложения улучшений, пожалуйста, создайте issue в репозитории проекта. 

## Запуск ETL-процесса и остальных компонентов


Search files...

Search files...

Search files...

Ran tool

Ran tool

Ran tool
Для запуска ETL процесса, линейной регрессии и ChatRank в вашем проекте существуют следующие способы:

### 1. Запуск ETL процесса

У вас есть несколько вариантов:

```bash
# Вариант 1: Запуск через shell-скрипт (рекомендуется)
cd ETL
./run_etl.sh         # Запуск в режиме планировщика (по расписанию)
./run_etl.sh once    # Однократный запуск

# Вариант 2: Прямой запуск через Go
cd ETL
go run etl_runner.go -mode=scheduled   # Запуск в режиме планировщика
go run etl_runner.go -mode=once        # Однократный запуск
```

### 2. Запуск линейной регрессии

Линейную регрессию можно запустить отдельно:

```bash
# Вариант 1: Запуск через shell-скрипт (рекомендуется)
cd ETL/linear_regression
./run_lr.sh                            # Запуск с параметрами по умолчанию
./run_lr.sh -d 30 -f 14 -c 0.95 -r 0.3 # Запуск с указанием параметров

# Опции:
# -d, --days ЧИСЛО      Количество дней для анализа (по умолчанию: 30)
# -f, --forecast ЧИСЛО  Количество дней для прогноза (по умолчанию: 14)
# -c, --confidence ЧИСЛО Уровень доверия (0.90, 0.95, 0.99) (по умолчанию: 0.95)
# -r, --min-r2 ЧИСЛО    Минимальный порог для R² (по умолчанию: 0.30)

# Вариант 2: Прямой запуск через Go
cd ETL
go run etl_runner.go -mode=lr -days=30 -forecast=14 -confidence=0.95 -min-r2=0.30
```

### 3. Запуск ChatRank

ChatRank также можно запустить как отдельную утилиту:

```bash
# Вариант 1: Запуск через shell-скрипт (рекомендуется)
cd ETL/chatRank
./run_chatrank.sh    # Запуск с параметрами по умолчанию
./run_chatrank.sh -d 0.85 -i 100 -e 0.0001 -t 0.25 -r 0.25 -l 0.25 -c 0.25

# Опции:
# -d, --damping ЧИСЛО         Коэффициент затухания (по умолчанию: 0.85)
# -i, --iterations ЧИСЛО      Максимальное число итераций (по умолчанию: 100)
# -e, --epsilon ЧИСЛО         Порог сходимости (по умолчанию: 0.0001)
# -t, --time-factor ЧИСЛО     Вес временного фактора (по умолчанию: 0.25)
# -r, --response-factor ЧИСЛО Вес фактора частоты ответов (по умолчанию: 0.25)
# -l, --length-factor ЧИСЛО   Вес фактора длины сообщений (по умолчанию: 0.25)
# -c, --continuation-factor ЧИСЛО Вес фактора продолжения беседы (по умолчанию: 0.25)

# Вариант 2: Прямой запуск через Go
cd ETL
go run etl_runner.go -mode=cr -damping=0.85 -iterations=100 -epsilon=0.0001 -time-factor=0.25 -response-factor=0.25 -length-factor=0.25 -continuation-factor=0.25
```
