# ETL-процесс для аналитической системы чатов

## Описание

ETL-процесс предназначен для извлечения данных из оперативной базы данных чатов (OLTP) и их загрузки в аналитическую базу данных (OLAP) для последующего анализа и создания отчетов.

## Структура проекта

```
ETL/
  ├── config/              - Конфигурация ETL-процесса
  ├── extractors/          - Компоненты для извлечения данных из OLTP
  ├── transform/           - Компоненты для трансформации данных
  ├── load/                - Компоненты для загрузки данных в OLAP
  ├── models/              - Модели данных
  ├── utils/               - Вспомогательные утилиты
  ├── etl_runner.go        - Основной файл для запуска ETL
  └── run_etl.sh           - Скрипт для удобного запуска ETL-процесса
```

## Компоненты ETL

### Extract (Извлечение)

Компоненты извлечения данных находятся в директории `extractors/`. Они отвечают за:
- Извлечение новых или измененных данных из OLTP базы
- Инкрементальную загрузку (обработку только новых данных)
- Получение метаданных о последних запусках

### Transform (Трансформация)

Компоненты трансформации данных находятся в директории `transform/`. Они отвечают за:
- Преобразование данных в формат, подходящий для OLAP
- Формирование измерений (время, пользователи)
- Формирование фактов (сообщения, чаты, активность)
- Вычисление агрегатов и метрик

### Load (Загрузка)

Компоненты загрузки данных находятся в директории `load/`. Они отвечают за:
- Загрузку трансформированных данных в OLAP базу
- Обновление существующих записей
- Журналирование процесса загрузки

## Запуск ETL-процесса

### Требования

- Go 1.19 или выше
- MySQL 5.7 или выше
- Доступ к OLTP и OLAP базам данных

### Настройка

Настройки ETL-процесса находятся в файле `config/config.go`. Основные параметры:
- Параметры подключения к OLTP и OLAP базам данных
- Интервал запуска ETL-процесса
- Размер пакета обрабатываемых данных
- Пороговые значения для метрик активности

### Способы запуска

#### Однократный запуск

```bash
./run_etl.sh once
```

#### Запуск в режиме планировщика

```bash
./run_etl.sh
```

В режиме планировщика ETL-процесс будет выполняться с интервалом, указанным в конфигурации (по умолчанию 1 час).

### Логирование

Логи ETL-процесса сохраняются в файл `etl_log_YYYY-MM-DD.log` в директории ETL. Они содержат:
- Информацию о времени запуска и завершения
- Количество обработанных записей
- Ошибки и предупреждения
- Метрики производительности

## Расширение функциональности

Для добавления новых типов данных или метрик необходимо:

1. Определить новые модели данных в `models/`
2. Добавить извлечение новых данных в соответствующий экстрактор
3. Добавить трансформацию данных в соответствующий трансформатор
4. Добавить загрузку новых данных в соответствующий загрузчик

## Мониторинг и аудит

История запусков ETL сохраняется в таблице `etl_run_log` в OLAP базе данных. 
Эту информацию можно использовать для:
- Мониторинга регулярности выполнения ETL
- Анализа объема обрабатываемых данных
- Диагностики ошибок
- Оптимизации процесса ETL

## Известные проблемы и ограничения

1. В текущей реализации нет возможности отката изменений в случае ошибки (отсутствие транзакций между OLTP и OLAP).
2. Не реализовано параллельное выполнение компонентов ETL для ускорения процесса.

## Контактная информация

При обнаружении ошибок или для предложения улучшений, пожалуйста, создайте issue в репозитории проекта. 