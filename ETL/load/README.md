# Компонент загрузки (Load) для ETL-процесса

## Описание

Компонент загрузки (Load) отвечает за запись трансформированных данных в аналитическую OLAP базу данных. Он принимает данные от компонента трансформации (Transform) и обеспечивает их корректную загрузку с учетом транзакционности, обработки ошибок и оптимизации производительности.

## Основные возможности

- Загрузка данных в измерения и таблицы фактов OLAP
- Транзакционная целостность при загрузке связанных данных
- Пакетная обработка для крупных наборов данных
- Обработка ошибок и откат транзакций при необходимости
- Логирование процесса загрузки
- Отслеживание метрик производительности

## Архитектура

Компонент загрузки организован по принципу интерфейсов и их реализаций:

- `Loader` - основной интерфейс для всех загрузчиков
- `OLAPLoader` - реализация интерфейса для работы с OLAP базой данных
- Специализированные загрузчики:
  - `UserLoader` - для измерения пользователей
  - `MessageLoader` - для фактов сообщений
  - `ChatLoader` - для фактов чатов
  - `ActivityLoader` - для фактов активности
- `LoadManager` - координирует процесс загрузки, управляет транзакциями и ведет журнал ETL

## Использование

### Инициализация

```go
// Создание загрузчика
db, _ := sql.Open("mysql", "dsn")
logger := utils.NewETLLogger()
loadManager := load.NewLoadManager(db, logger)
```

### Загрузка данных

```go
// Подготовка данных для загрузки
transformedData := &models.TransformedData{
    Users:         []models.UserDimension{...},
    Messages:      []models.MessageFact{...},
    Chats:         []models.ChatFact{...},
    DailyActivity: []models.DailyActivityFact{...},
    HourlyActivity: []models.HourlyActivityFact{...},
}

// Загрузка данных
err := loadManager.Load(transformedData)
if err != nil {
    // Обработка ошибки
}
```

### Обновление журнала ETL

```go
// Обновление информации о запуске ETL
runLog := &models.ETLRunLog{
    ID:                    1,
    EndTime:               time.Now(),
    Status:                "success",
    UsersProcessed:        100,
    ChatsProcessed:        50,
    MessagesProcessed:     1000,
    LastProcessedMessageID: 5000,
}
err := loadManager.UpdateETLRunLog(runLog)
```

## Интеграция с другими компонентами ETL

Компонент загрузки (Load) является заключительным этапом ETL-процесса. Он интегрируется с:

1. Компонентом извлечения (Extract) - непрямо, через трансформацию
2. Компонентом трансформации (Transform) - напрямую, получая трансформированные данные
3. Журналом ETL - для записи результатов выполнения процесса

## Оптимизация производительности

Для оптимизации производительности загрузки используются следующие техники:

- Пакетная обработка данных
- Переиспользование подготовленных запросов
- Транзакции с оптимальным размером
- Журналирование только важных сообщений
- Обработка больших наборов данных частями

## Расширение функциональности

Для добавления поддержки новых типов данных:

1. Определите новую структуру данных в `models`
2. Создайте новый загрузчик, реализующий логику загрузки
3. Добавьте новый метод в интерфейс `Loader`
4. Реализуйте метод в `OLAPLoader` 