# ChatRank: Модификация алгоритма PageRank для ранжирования влиятельности пользователей в чатах

## Описание

ChatRank — это уникальный алгоритм, основанный на модификации PageRank для анализа и ранжирования пользователей по их влиятельности в системе чатов. Основное отличие от стандартного PageRank в том, что связи между пользователями (аналоги "ссылок" в веб-графе) определяются не только количеством сообщений, но и многомерными факторами качества коммуникации.

## Теоретическая основа

### Классический алгоритм PageRank

Алгоритм PageRank, разработанный основателями Google Ларри Пейджем и Сергеем Брином, изначально предназначался для ранжирования веб-страниц в поисковой выдаче. Ключевая идея состоит в том, что важность страницы определяется количеством и качеством ссылок, указывающих на неё.

В классическом PageRank важность страницы p вычисляется по формуле:

```
PR(p) = (1-d) + d * Sum(PR(i)/L(i))
```

где:
- PR(p) — ранг страницы p
- d — коэффициент затухания (обычно 0.85)
- PR(i) — ранг страницы i, ссылающейся на страницу p
- L(i) — количество исходящих ссылок со страницы i

### Адаптация для чат-коммуникаций: ChatRank

В контексте чат-коммуникаций мы модифицируем алгоритм PageRank следующим образом:
- **Узлы графа** — пользователи вместо веб-страниц
- **Направленные рёбра** — сообщения от одного пользователя другому
- **Веса рёбер** — определяются не только количеством сообщений, но и их характеристиками

Факторы, влияющие на вес коммуникационной связи:
1. **Временной фактор** (скорость ответа)
2. **Фактор частоты ответов** (как часто отвечает на сообщения)
3. **Фактор длины сообщений** (информационная ценность)
4. **Фактор количества сообщений** (общая активность в коммуникации)

## Формула ChatRank

Базовая формула ChatRank:

```
CR(u) = (1-d) + d * Sum(CR(v) * W(v,u) / O(v))
```

где:
- CR(u) — ранг влиятельности пользователя u
- d — коэффициент затухания (0.85)
- CR(v) — ранг пользователя v, отправлявшего сообщения пользователю u
- W(v,u) — вес коммуникационной связи от v к u
- O(v) — сумма весов всех исходящих связей от пользователя v

Вес коммуникационной связи:

```
W(v,u) = α * T(v,u) + β * R(v,u) + γ * L(v,u) + δ * F(v,u)
```

где:
- T(v,u) — временной фактор (скорость ответа)
- R(v,u) — частота ответов
- L(v,u) — длина сообщений
- F(v,u) — фактор количества сообщений
- α, β, γ, δ — веса факторов (в сумме 1)

## Интеграция с ETL-процессом

Модуль ChatRank интегрирован в основной ETL-процесс в качестве дополнительного шага после загрузки данных. Он выполняет следующие действия:

1. Извлекает данные о сообщениях и их характеристиках из OLAP-куба
2. Вычисляет веса коммуникационных связей между пользователями
3. Строит граф коммуникаций на основе этих связей
4. Выполняет итерационный алгоритм расчета ChatRank до сходимости
5. Нормализует и категоризирует ранги пользователей
6. Сохраняет результаты в таблицы OLAP-куба для дальнейшего анализа

## Использование

### Как часть ETL-процесса

ChatRank автоматически выполняется после завершения основных фаз ETL:

```bash
./run_etl.sh
```

### Как отдельная утилита

Модуль можно запустить отдельно для настройки параметров алгоритма:

```bash
./chatRank/run_chatrank.sh [опции]
```

Опции:
- `-d, --damping ЧИСЛО` - коэффициент затухания (по умолчанию: 0.85)
- `-i, --iterations ЧИСЛО` - максимальное количество итераций (по умолчанию: 100)
- `-e, --epsilon ЧИСЛО` - порог сходимости (по умолчанию: 0.0001)
- `-tf, --time-factor ЧИСЛО` - вес временного фактора (по умолчанию: 0.25)
- `-rf, --response-factor ЧИСЛО` - вес фактора частоты ответов (по умолчанию: 0.25)
- `-lf, --length-factor ЧИСЛО` - вес фактора длины сообщений (по умолчанию: 0.25)
- `-cf, --continuation-factor ЧИСЛО` - вес фактора количества сообщений (по умолчанию: 0.25)

Пример:
```bash
./chatRank/run_chatrank.sh --damping 0.90 --time-factor 0.4 --response-factor 0.3 --length-factor 0.2 --continuation-factor 0.1
```

### Через ETL Runner

Можно также запустить через ETL Runner напрямую:

```bash
go run ETL/etl_runner.go -mode=cr -damping=0.85 -iterations=100 -epsilon=0.0001 -time-factor=0.25 -response-factor=0.25 -length-factor=0.25 -continuation-factor=0.25
```

## Результаты и их применение

ChatRank позволяет категоризировать пользователей на три группы:
- **Влиятельные узлы** (высокий ChatRank > 90-й процентиль) 
- **Связующие узлы** (средний ChatRank, 50-90-й процентиль)
- **Обычные пользователи** (низкий ChatRank < 50-й процентиль)

Практическое применение результатов:
1. **Оптимизация коммуникаций**: выявление и поддержка влиятельных пользователей
2. **Маркетинг**: целевое распространение информации через ключевых коммуникаторов
3. **Модерация**: приоритизация проверки сообщений влиятельных пользователей
4. **Развитие сообщества**: стимулирование взаимодействия между разными группами

## Расширения и будущие улучшения

Алгоритм ChatRank может быть расширен и улучшен следующими способами:
1. Добавление анализа тональности сообщений как фактора влияния
2. Учет временных паттернов активности пользователей
3. Применение алгоритмов обнаружения сообществ для выявления групп коммуникации
4. Динамический анализ изменения рангов пользователей во времени 